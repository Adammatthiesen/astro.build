---
const { href, items = [] } = Astro.props;
const Tag = href ? 'a' : 'div';
// A rough estimate of the content width based on RT Alias Medium Bold @ 12px
const length = items.join('').length * 8.75;
---

<not-marquee style={`--length: ${length};`} aria-hidden="true">
    <Tag {href} class="track">
        {Array.from({ length: 8 }, (_, i) => <span class="group" id={i === 0 ? 'not-marquee--measure' : undefined}>{items.map(item => <span>{item}</span>)}</span>)}
    </Tag>
</not-marquee>

<script hoist type="module">
const marquee = document.querySelector('not-marquee');
const measure = document.querySelector('#not-marquee--measure');
marquee.style.setProperty('--length', Math.round(measure.getBoundingClientRect().width));
</script>

<style>
    not-marquee {
        --speed: 15;
        --gap: 4rem;
        --tx: calc(calc(var(--length) * 1px) + var(--gap));
        display: flex;
        position: relative;
        width: 100vw;
        height: 32px;
        overflow-x: hidden;

        background-color: white;
        border-bottom: 1px solid black;
        font-family: var(--font-display);
        text-transform: uppercase;
        font-size: 0.75em;
        font-weight: 700;
        letter-spacing: 1px;
        background: white;
        z-index: 1;
    }

    not-marquee:hover .track {
        animation-play-state: paused;
    }

    .track {
        height: 100%;
        width: 100%;
        transform: translateX(calc(var(--tx) * -1.5));
        display: flex;
        align-items: center;
        /* justify-content: center; */
        position: absolute;
        white-space: nowrap;
        will-change: transform;
        text-decoration: none;
        color: var(--color-midnight);
        transition: color 300ms cubic-bezier(0.23, 1, 0.320, 1);
    }

    a.track:hover,
    a.track:focus {
        color: var(--color-purple);
    }

    a.track:active {
        color: var(--color-blue);
    }

    .group {
        position: relative;
        display: inline-block;
        padding: 0.5em 0.5em;
        animation: marquee calc(var(--speed) * 1s) linear infinite;
    }

    @media (prefers-reduced-motion: reduce) {
        not-marquee {
            --gap: 1rem;
        }
        .track {
            transform: none;
            justify-content: flex-start;
        }
        .group {
            animation: none;
        }
        span + span::before {
            content: "â€¢";
            padding-right: var(--gap);
        }
    }

    span + span {
        padding-left: var(--gap);
    }

    @keyframes marquee {
        from { transform: translateX(var(--tx)) }
        to { transform: translateX(0) }
    }
</style>
